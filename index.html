<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>FC Barcelona Widget</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Anton&display=swap');
  html,body{margin:0;padding:0;height:100%;background:#111;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;text-transform:uppercase;}
  .widget{width:90vw;max-width:900px;aspect-ratio:16/9;background:linear-gradient(145deg,#0B2447,#A71930);padding:20px;color:#444;position:relative;box-sizing:border-box;}
  .countdown{display:flex;justify-content:center;gap:20px;margin-bottom:12px;}
  .cd-block{text-align:center;}
  .cd-block .label{font-size:14px;color:#ccc;font-weight:600;text-transform:lowercase;}
  .cd-block .value{font-size:28px;color:#fff;font-weight:700;}
  .main{text-align:center;}
  .logos{display:flex;justify-content:center;align-items:center;gap:40px;margin-bottom:8px;}
  .logos img{height:120px;filter:drop-shadow(0 0 3px rgba(0,0,0,0.7));}
  .vs{font-size:56px;font-weight:400;color:#fff;}
  .info{font-size:13px;font-weight:400;color:#fff;line-height:1.3;margin-top:4px;}
  .opponents{display:flex;justify-content:center;gap:8px;margin-top:8px;}
  .opponent-box{width:54px;height:72px;padding:4px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;box-shadow:0 0 3px rgba(0,0,0,0.5);border-radius:0;position:relative;overflow:hidden;}
  .crest{width:54px;height:54px;object-fit:contain;z-index:1;}
  .bottom-strip{position:absolute;bottom:0;left:0;width:100%;height:25%;display:flex;align-items:center;justify-content:space-between;padding:0 10px;box-sizing:border-box;z-index:0;gap:4px;}
  .opponent-box.home .bottom-strip{background:#003366;}
  .opponent-box.away .bottom-strip{background:#8B0000;}
  .day{color:#fff;font-size:12px;font-weight:400;}
  .competition-logo{width:16px;height:16px;object-fit:contain;}
</style>
</head><body>
<div class="widget">
  <div class="countdown">
    <div class="cd-block"><div class="label">days</div><div class="value" id="days">0</div></div>
    <div class="cd-block"><div class="label">hours</div><div class="value" id="hours">00</div></div>
    <div class="cd-block"><div class="label">mins</div><div class="value" id="minutes">00</div></div>
    <div class="cd-block"><div class="label">secs</div><div class="value" id="seconds">00</div></div>
  </div>
  <div class="main">
    <div class="logos">
      <img id="home-logo" src="" alt="Home Team"/>
      <div class="vs" style="font-weight:400;">v</div>
      <img id="away-logo" src="https://crests.football-data.org/81.png" alt="FC Barcelona"/>
    </div>
    <div class="info" id="match-info">Loading...</div>
  </div>
  <div class="opponents" id="upcoming-fixtures"></div>
</div>
<script>
const API_KEY = "4fc4f86dea0b482b9e3f03035e083cf7";
const BARCA_ID = 81;

async function fetchLiveFixtures() {
  try {
    const response = await fetch(`https://api.football-data.org/v4/teams/${BARCA_ID}/matches?status=SCHEDULED`, {
      headers: { 'X-Auth-Token': API_KEY }
    });
    if (!response.ok) throw new Error("API request failed");
    const data = await response.json();
    return data.matches.slice(0, 6);
  } catch (e) {
    console.error("Failed to fetch fixtures:", e);
    return [];
  }
}

function updateCountdown(targetDate) {
  function tick() {
    const now = new Date();
    const diff = targetDate - now;
    if (diff <= 0) return;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);
    document.getElementById('days').textContent = Math.max(days, 0);
    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
  }
  tick();
  setInterval(tick, 1000);
}

async function initFixturesWidget() {
  const fixtures = await fetchLiveFixtures();
  if (!fixtures || fixtures.length === 0) return;
  const container = document.getElementById('upcoming-fixtures');
  container.innerHTML = '';

  const main = fixtures[0];
  const isHome = main.homeTeam.id === BARCA_ID;
  document.getElementById('home-logo').src = isHome ? "https://crests.football-data.org/81.png" : main.homeTeam.crest;
  document.getElementById('away-logo').src = isHome ? main.awayTeam.crest : "https://crests.football-data.org/81.png";

  const matchDate = new Date(main.utcDate);
  const formatted = matchDate.toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' });
  const time = matchDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  const stadium = main.venue || 'Unknown Stadium';
  const competition = main.competition.name || 'Competition';
  document.getElementById('match-info').textContent = `${formatted} · ${time} · ${stadium} · ${competition}`;

  updateCountdown(matchDate);

  fixtures.slice(1).forEach(fx => {
    const dateObj = new Date(fx.utcDate);
    const day = String(dateObj.getDate()).padStart(2, '0');
    const isHomeFx = fx.homeTeam.id === BARCA_ID;
    const crest = isHomeFx ? fx.awayTeam.crest : fx.homeTeam.crest;
    const compName = fx.competition.name?.split(' ')[0] || '';
    const box = document.createElement('div');
    box.classList.add('opponent-box', isHomeFx ? 'home' : 'away');
    box.innerHTML = `
      <img class="crest" src="${crest}" alt="crest" onerror="this.style.display='none'"/>
      <div class="bottom-strip">
        <div class="day">${day}</div>
        <div class="competition-logo">${compName}</div>
      </div>`;
    container.appendChild(box);
  });
}

initFixturesWidget();
</script>
</body></html>
