<script>
let COUNTDOWN_TARGET = new Date('2025-08-04T20:30:00+02:00');

function updateCountdown() {
  const now = new Date(), diff = COUNTDOWN_TARGET - now;
  const d = Math.max(0, Math.floor(diff / 864e5));
  const h = String(Math.floor((diff / 36e5) % 24)).padStart(2,'0');
  const m = String(Math.floor((diff / 6e4) % 60)).padStart(2,'0');
  const s = String(Math.floor((diff / 1e3) % 60)).padStart(2,'0');
  document.getElementById('days').textContent = d;
  document.getElementById('hours').textContent = h;
  document.getElementById('minutes').textContent = m;
  document.getElementById('seconds').textContent = s;
}
updateCountdown();
setInterval(updateCountdown, 1000);

// Fetch fixture data
fetch('/.netlify/functions/getFixtures')
  .then(res => res.json())
  .then(data => {
    const fixtures = data.response;
    if (!fixtures || fixtures.length === 0) return;

    const nextMatch = fixtures[0];
    const home = nextMatch.teams.home;
    const away = nextMatch.teams.away;
    const date = new Date(nextMatch.fixture.date);

    // Set correct countdown
    COUNTDOWN_TARGET = date;

    // Always show home team on the left
    document.getElementById('home-logo').src = home.logo;
    document.getElementById('home-logo').alt = home.name;
    document.getElementById('away-logo').src = away.logo;
    document.getElementById('away-logo').alt = away.name;

    document.getElementById('match-info').textContent =
      `${date.toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' })} · ` +
      `${date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })} · ` +
      `${nextMatch.fixture.venue.name} · ${nextMatch.league.name}`;

    // Next 5 opponents
    const container = document.querySelector('.opponents');
    container.innerHTML = '';
    fixtures.slice(0, 5).forEach(match => {
      const isHome = match.teams.home.name.toLowerCase().includes("barcelona");
      const barcaHome = isHome;
      const opponent = isHome ? match.teams.away : match.teams.home;
      const crest = opponent.logo;
      const day = new Date(match.fixture.date).getDate().toString().padStart(2, '0');
      const compLogo = match.league.logo;

      const box = document.createElement('div');
      box.className = `opponent-box ${barcaHome ? 'home' : 'away'}`;
      box.innerHTML = `
        <img class="crest" src="${crest}" alt="${opponent.name}"/>
        <div class="bottom-strip">
          <div class="day">${day}</div>
          <img class="competition-logo" src="${compLogo}" alt="${match.league.name}"/>
        </div>
      `;
      container.appendChild(box);
    });
  })
  .catch(err => {
    console.error('Error fetching fixtures:', err);
  });
</script>
